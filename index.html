<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Immersive Reader</title>
  <script src="https://ircdn.azureedge.net/immersivereader/sdk/immersivereader-sdk.1.3.0.js"></script>
</head>
<body style="font-family: Arial, sans-serif; padding: 24px;">
  <h2>Immersive Reader Launcher</h2>
  <p id="launching">Preparing your content...</p>

  <script>
    function getQueryParam(param) {
      const params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

    async function launchReader() {
      const text = decodeURIComponent(getQueryParam('text') || "No content provided.");

      document.getElementById('launching').innerText = "Launching Immersive Reader...";

      try {
        const res = await fetch('https://cfd30ec7-ba64-4e3d-91ce-46c450f1358d-00-14hq9sdo2wdsi.janeway.replit.dev/token');
        const { token, subdomain } = await res.json();

        const content = {
          title: "Reading Content",
          chunks: [
            {
              content: text,
              lang: 'en'
            }
          ]
        };

        ImmersiveReader.launchAsync(token, subdomain, content);
      } catch (error) {
        console.error("Immersive Reader Error:", error);
        document.getElementById('launching').innerText = "Failed to launch. See console.";
      }
    }

    launchReader();
  </script>
</body>
</html>
